<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Operations Warehouse 2</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Kanit', sans-serif; background-color: #f8fafc; }
        .bg-navy { background-color: #0f172a; }
        .text-orange { color: #f97316; }
        .shadow-luxury { box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1); }
    </style>
</head>
<body>

    <nav class="bg-navy text-white shadow-luxury sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 flex justify-between items-center h-16">
            <div class="flex items-center space-x-3">
                <div class="bg-orange-500 p-2 rounded-lg">
                    <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M4 7v10c0 2.21 3.58 4 8 4s8-1.79 8-4V7M4 7c0 2.21 3.58 4 8 4s8-1.79 8-4M4 7c0-2.21 3.58-4 8-4s8 1.79 8 4m0 5c0 2.21-3.58 4-8 4s-8-1.79-8-4"></path></svg>
                </div>
                <span class="text-xl font-bold tracking-wider">PROJECT: <span class="text-orange-400">OPERATIONS WAREHOUSE 2</span></span>
            </div>
        </div>
    </nav>

    <div class="max-w-7xl mx-auto px-4 py-8">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
            <div class="bg-white p-6 rounded-2xl shadow-sm border-l-8 border-orange-500 shadow-luxury">
                <p class="text-sm font-medium text-slate-500 uppercase tracking-wider">Total Outbound (Tons)</p>
                <h3 id="card-outbound" class="text-4xl font-bold text-navy mt-1">0.00</h3>
                <p class="text-xs text-slate-400 mt-2">จัดส่งให้ลูกค้า / ลูกค้ามารับเอง</p>
            </div>
            <div class="bg-white p-6 rounded-2xl shadow-sm border-l-8 border-sky-500 shadow-luxury">
                <p class="text-sm font-medium text-slate-500 uppercase tracking-wider">Total Inbound (Tons)</p>
                <h3 id="card-inbound" class="text-4xl font-bold text-navy mt-1">0.00</h3>
                <p class="text-xs text-slate-400 mt-2">รับสินค้าเข้า จาก PO</p>
            </div>
        </div>

        <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-200 mb-6">
            <h4 class="text-navy font-bold mb-4 flex items-center"><span class="w-2 h-5 bg-orange-500 rounded-full mr-2"></span>ตัวกรองข้อมูลที่สัมพันธ์กัน</h4>
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                <div>
                    <label class="block text-xs font-semibold text-slate-500 mb-1">Month</label>
                    <select id="filter-month" multiple class="w-full border rounded-lg p-2 text-sm focus:ring-2 focus:ring-orange-500 outline-none h-24"></select>
                </div>
                <div>
                    <label class="block text-xs font-semibold text-slate-500 mb-1">Week</label>
                    <select id="filter-week" multiple class="w-full border rounded-lg p-2 text-sm focus:ring-2 focus:ring-orange-500 outline-none h-24"></select>
                </div>
                <div>
                    <label class="block text-xs font-semibold text-slate-500 mb-1">Date</label>
                    <select id="filter-date" multiple class="w-full border rounded-lg p-2 text-sm focus:ring-2 focus:ring-orange-500 outline-none h-24"></select>
                </div>
                <div>
                    <label class="block text-xs font-semibold text-slate-500 mb-1">Shipment Type</label>
                    <select id="filter-type" multiple class="w-full border rounded-lg p-2 text-sm focus:ring-2 focus:ring-orange-500 outline-none h-24"></select>
                </div>
            </div>
            <div class="mt-4 flex justify-end">
                <button onclick="applyFilters()" class="bg-navy text-white px-6 py-2 rounded-lg hover:bg-slate-800 transition-all text-sm font-bold">กรองข้อมูล</button>
            </div>
        </div>

        <div id="status-msg" class="text-center py-10 text-slate-400 bg-white rounded-xl border border-dashed border-slate-300">
            ระบบกำลังเตรียมการดึงข้อมูลจากตาราง "FG In-Out"...
        </div>
    </div>

    <script>
        const SUPABASE_URL = 'https://gkkboducoidzusriylsq.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imdra2JvZHVjb2lkenVzcml5bHNxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njk5NTgwODEsImV4cCI6MjA4NTUzNDA4MX0.-wdysRXN-YGzAjQgi3mc50WY91VjsZJlXAe7a65MjXw';
        const supabase = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        let allData = [];

        async function fetchData() {
            document.getElementById('status-msg').innerHTML = "กำลังดึงข้อมูล...";
            const { data, error } = await supabase
                .from('FG In-Out')
                .select('Month, Week, Date, "Shipment type", "Gross weight"');

            if (error) {
                document.getElementById('status-msg').innerHTML = "Error: " + error.message;
                return;
            }

            allData = data;
            setupFilters();
            calculateStats(allData);
            document.getElementById('status-msg').innerHTML = "ดึงข้อมูลสำเร็จ! จำนวน " + data.length + " รายการ";
        }

        function setupFilters() {
            const columns = ['Month', 'Week', 'Date', 'Shipment type'];
            const ids = ['filter-month', 'filter-week', 'filter-date', 'filter-type'];

            ids.forEach((id, index) => {
                const select = document.getElementById(id);
                const uniqueValues = [...new Set(allData.map(item => item[columns[index]]))].sort();
                select.innerHTML = uniqueValues.map(v => `<option value="${v}">${v}</option>`).join('');
            });
        }

        function calculateStats(data) {
            let outboundWeight = 0;
            let inboundWeight = 0;

            data.forEach(item => {
                const weight = parseFloat(item['Gross weight']) || 0;
                const type = item['Shipment type'];

                if (type === 'จัดส่งให้ลูกค้า' || type === 'ลูกค้ามารับเอง') {
                    outboundWeight += weight;
                } else if (type === 'รับสินค้าเข้า จาก PO') {
                    inboundWeight += weight;
                }
            });

            document.getElementById('card-outbound').innerText = (outboundWeight / 1000).toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2});
            document.getElementById('card-inbound').innerText = (inboundWeight / 1000).toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2});
        }

        function applyFilters() {
            const monthVal = Array.from(document.getElementById('filter-month').selectedOptions).map(o => o.value);
            const weekVal = Array.from(document.getElementById('filter-week').selectedOptions).map(o => o.value);
            const dateVal = Array.from(document.getElementById('filter-date').selectedOptions).map(o => o.value);
            const typeVal = Array.from(document.getElementById('filter-type').selectedOptions).map(o => o.value);

            const filtered = allData.filter(item => {
                return (monthVal.length === 0 || monthVal.includes(item.Month)) &&
                       (weekVal.length === 0 || weekVal.includes(item.Week)) &&
                       (dateVal.length === 0 || dateVal.includes(item.Date)) &&
                       (typeVal.length === 0 || typeVal.includes(item['Shipment type']));
            });

            calculateStats(filtered);
            document.getElementById('status-msg').innerHTML = "แสดงผลการกรอง: " + filtered.length + " รายการ";
        }

        fetchData();
    </script>
</body>
</html>
